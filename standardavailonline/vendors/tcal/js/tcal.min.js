function f_tcalGetHTML(a){var n=f_tcalGetInputs(!0);if(n){var e=A_TCALCONF.cssprefix,t=A_TCALCONF.format,s=f_tcalParseDate(A_TCALCONF.today,A_TCALCONF.format);s||(s=f_tcalResetTime(new Date));var i=f_tcalParseDate(n.value,t);i||(i=f_tcalParseDate(A_TCALCONF.selected,A_TCALCONF.format)),i||(i=new Date(s)),a=a?f_tcalResetTime(a):new Date(i);var o=new Date(a);o.setDate(1),o.setDate(1-(7+o.getDay()-A_TCALCONF.weekstart)%7);for(var c,l='<table id="'+e+'Controls"><tbody><tr>'+(A_TCALCONF.yearscroll?'<td id="'+e+'PrevYear" '+f_tcalRelDate(a,-1,"y")+' title="'+A_TCALCONF.prevyear+'"></td>':"")+'<td id="'+e+'PrevMonth"'+f_tcalRelDate(a,-1)+' title="'+A_TCALCONF.prevmonth+'"></td><th>'+A_TCALCONF.months[a.getMonth()]+" "+a.getFullYear()+'</th><td id="'+e+'NextMonth"'+f_tcalRelDate(a,1)+' title="'+A_TCALCONF.nextmonth+'"></td>'+(A_TCALCONF.yearscroll?'<td id="'+e+'NextYear"'+f_tcalRelDate(a,1,"y")+' title="'+A_TCALCONF.nextyear+'"></td>':"")+'</tr></tbody></table><table id="'+e+'Grid"><tbody><tr>',r=0;7>r;r++)l+="<th>"+A_TCALCONF.weekdays[(A_TCALCONF.weekstart+r)%7]+"</th>";l+="</tr>";for(var u,$,d=new Date(o);d.getMonth()==a.getMonth()||d.getMonth()==o.getMonth();){l+="<tr>";for(var p=0;7>p;p++)c=[],u=d.getDate(),$=d.getMonth(),d.getMonth()!=a.getMonth()&&(c[c.length]=e+"OtherMonth"),(0==d.getDay()||6==d.getDay())&&(c[c.length]=e+"Weekend"),d.valueOf()==s.valueOf()&&(c[c.length]=e+"Today"),d.valueOf()==i.valueOf()&&(c[c.length]=e+"Selected"),l+="<td"+f_tcalRelDate(d)+(c.length?' class="'+c.join(" ")+'">':">")+u+"</td>",d.setDate(++u);l+="</tr>"}return l+="</tbody></table>"}}function f_tcalRelDate(a,n,e){var e="y"==e?"FullYear":"Month",t=new Date(a);return n&&(t["set"+e](a["get"+e]()+n),t.getDate()!=a.getDate()&&t.setDate(0)),' onclick="f_tcalUpdate('+t.valueOf()+(n?",1":"")+')"'}function f_tcalResetTime(a){return a.setMilliseconds(0),a.setSeconds(0),a.setMinutes(0),a.setHours(12),a}function f_tcalCancel(){var a=A_TCALCONF.cssprefix,n=document.getElementById(a);n&&(n.style.visibility="");for(var e=f_tcalGetInputs(),t=0;t<e.length;t++)f_tcalRemoveClass(e[t],a+"Active")}function f_tcalUpdate(a,n){var e=f_tcalGetInputs(!0);if(e){d_date=new Date(a);var t=A_TCALCONF.cssprefix;if(n){var s=document.getElementById(t);if(!s||"visible"!=s.style.visibility)return;s.innerHTML=f_tcalGetHTML(d_date,e)}else e.value=f_tcalGenerateDate(d_date,A_TCALCONF.format),f_tcalCancel()}}function f_tcalOnClick(){var a=A_TCALCONF.cssprefix,n=a+"Active",e=f_tcalHasClass(this,n);if(f_tcalCancel(),!e){f_tcalAddClass(this,n);var t=f_getPosition(this,"Left"),s=f_getPosition(this,"Top")+this.offsetHeight,i=document.getElementById(a);i||(i=document.createElement("div"),i.onselectstart=function(){return!1},i.id=a,document.getElementsByTagName("body").item(0).appendChild(i)),i.innerHTML=f_tcalGetHTML(null),i.style.top=s+"px",i.style.left=t+this.offsetWidth-i.offsetWidth+"px",i.style.visibility="visible"}}function f_tcalParseDate(a,n){if(a){for(var e,t="^",s={},i=0,o=0;o<n.length;o++)e=n.charAt(o),A_TCALTOKENS_IDX[e]?(s[e]=++i,t+="("+A_TCALTOKENS_IDX[e].r+")"):t+=" "==e?"\\s":(e.match(/[\w\d]/)?"":"\\")+e;var c=new RegExp(t+"$");if(a.match(c)){var l,r=f_tcalResetTime(new Date);for(r.setDate(1),o=0;o<A_TCALTOKENS.length;o++)e=A_TCALTOKENS[o].t,s[e]&&(l=RegExp["$"+s[e]],r=A_TCALTOKENS[o].p(r,l));return r}}}function f_tcalGenerateDate(a,n){for(var e,t="",s=0;s<n.length;s++)e=n.charAt(s),t+=A_TCALTOKENS_IDX[e]?A_TCALTOKENS_IDX[e].g(a):e;return t}function f_tcalGetInputs(a){var e,t=document.getElementsByTagName("input"),s=[];for(n=0;n<t.length;n++)if(e=t[n],e.type&&"text"==e.type&&f_tcalHasClass(e,"tcal")){if(a&&f_tcalHasClass(e,A_TCALCONF.cssprefix+"Active"))return e;s[s.length]=e}return a?null:s}function f_tcalHasClass(a,n){var e=a.className;if(!e)return!1;for(var t=e.split(" "),s=0;s<t.length;s++)if(t[s]==n)return!0;return!1}function f_tcalAddClass(a,n){if(!f_tcalHasClass(a,n)){var e=a.className;a.className=(e?e+" ":"")+n}}function f_tcalRemoveClass(a,n){var e=a.className;if(!e||-1==e.indexOf(n))return!1;for(var t=e.split(" "),s=[],i=0;i<t.length;i++)t[i]!=n&&(s[s.length]=t[i]);return a.className=s.join(" "),!0}function f_getPosition(a,n){for(var e,t=0,s=a;s;)e=s["offset"+n],t+=e,s=s.offsetParent;for(s=a;s!=document.body;)e=s["scroll"+n],e&&"scroll"==s.style.overflow&&(t-=e),s=s.parentNode;return t}function f_tcalInit(){if(document.getElementsByTagName){for(var a,n=f_tcalGetInputs(),e=0;e<n.length;e++)a=n[e],a.onclick=f_tcalOnClick,f_tcalAddClass(a,A_TCALCONF.cssprefix+"Input");for(window.A_TCALTOKENS_IDX={},e=0;e<A_TCALTOKENS.length;e++)A_TCALTOKENS_IDX[A_TCALTOKENS[e].t]=A_TCALTOKENS[e]}}function f_tcalAddOnload(a){if(document.addEventListener)window.addEventListener("load",a,!1);else if(window.attachEvent)window.attachEvent("onload",a);else{var n=window.onload;window.onload="function"!=typeof window.onload?a:function(){n(),a()}}}var A_TCALCONF={cssprefix:"tcal",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Su","Mo","Tu","We","Th","Fr","Sa"],longwdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],yearscroll:!0,weekstart:0,prevyear:"Previous Year",nextyear:"Next Year",prevmonth:"Previous Month",nextmonth:"Next Month",format:"Y-m-d"},A_TCALTOKENS=[{t:"Y",r:"19\\d{2}|20\\d{2}",p:function(a,n){return a.setFullYear(Number(n)),a},g:function(a){var n=a.getFullYear();return n}},{t:"m",r:"0?[1-9]|1[0-2]",p:function(a,n){return a.setMonth(Number(n)-1),a},g:function(a){var n=a.getMonth()+1;return(10>n?"0":"")+n}},{t:"F",r:A_TCALCONF.months.join("|"),p:function(a,n){for(var e=0;12>e;e++)if(A_TCALCONF.months[e]==n)return a.setMonth(e),a},g:function(a){return A_TCALCONF.months[a.getMonth()]}},{t:"d",r:"0?[1-9]|[12][0-9]|3[01]",p:function(a,n){return a.setDate(Number(n)),a.getDate()!=n&&a.setDate(0),a},g:function(a){var n=a.getDate();return(10>n?"0":"")+n}},{t:"j",r:"0?[1-9]|[12][0-9]|3[01]",p:function(a,n){return a.setDate(Number(n)),a.getDate()!=n&&a.setDate(0),a},g:function(a){var n=a.getDate();return n}},{t:"l",r:A_TCALCONF.longwdays.join("|"),p:function(a){return a},g:function(a){return A_TCALCONF.longwdays[a.getDay()]}},{t:"S",r:"st|nd|rd|th",p:function(a){return a},g:function(a){return n_date=a.getDate(),1==n_date%10&&11!=n_date?"st":2==n_date%10&&12!=n_date?"nd":3==n_date%10&&13!=n_date?"rd":"th"}}];f_tcalAddOnload(f_tcalInit);